name: Deploy

on:
  tags:
    - v*

jobs:
  deploy-kovan:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout üõéÔ∏è
        uses: actions/checkout@v2
        with:
          persist-credentials: false
      - name: Install üîß
        run: npm install
      - name: Create .env üíª
        run: |
          cp env.integration.sample .integration.env
          sed -i "s/<ADMIN_ADDRESS>/$ADMIN_ADDRESS/g" .integration.env
          sed -i "s/<SETTLER_ADDRESS>/$SETTLER_ADDRESS/g" .integration.env
          sed -i "s/<ENZYME_DEPLOYER>/$ENZYME_DEPLOYER/g" .integration.env
          sed -i "s/<ENZYME_INT_MANAGER>/$ENZYME_INT_MANAGER/g" .integration.env
          sed -i "s/<ENZYME_ASSET_ADAPTER>/$ENZYME_ASSET_ADAPTER/g" .integration.env
          sed -i "s/<ENZYME_POLICY_MANAGER>/$ENZYME_POLICY_MANAGER/g" .integration.env
          sed -i "s/<ENZYME_INVESTOR_WHITELIST>/$ENZYME_INVESTOR_WHITELIST/g" .integration.env
          sed -i "s/<DENOM_ASSET_ADDRESS>/$DENOM_ASSET_ADDRESS/g" .integration.env
          sed -i "s/<DENOM_ASSET_SYMBOL>/$DENOM_ASSET_SYMBOL/g" .integration.env
          sed -i "s/<VAULT_NAME>/$VAULT_NAME/g" .integration.env
          sed -i "s/<TOKEN_NAME>/$TOKEN_NAME/g" .integration.env
          sed -i "s/<TOKEN_SYMBOL>/$TOKEN_SYMBOL/g" .integration.env
      - name: Compile üèóÔ∏è
        run: npx run deploy:kovan
    env:
      ALCHEMY_APIKEY: ${{ secrets.ALCHEMYAPIKEY }}
      KOVAN_PRIVATE_KEY: ${{ secrets.KOVAN_PRIVATE_KEY }}
